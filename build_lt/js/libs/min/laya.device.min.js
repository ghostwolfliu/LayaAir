!function(e,t){"use strict";class a{constructor(){}}class i{constructor(){}}let n=(()=>{class e extends t.EventDispatcher{constructor(e){super(),this.onDeviceOrientationChange=this.onDeviceOrientationChange.bind(this)}static get instance(){return e._instance=e._instance||new e(0),e._instance}on(e,a,i,n=null){return super.on(e,a,i,n),t.ILaya.Browser.window.addEventListener("devicemotion",this.onDeviceOrientationChange),this}off(e,a,i,n=!1){return this.hasListener(e)||t.ILaya.Browser.window.removeEventListener("devicemotion",this.onDeviceOrientationChange),super.off(e,a,i,n)}onDeviceOrientationChange(a){var i=a.interval;e.acceleration.x=a.acceleration.x,e.acceleration.y=a.acceleration.y,e.acceleration.z=a.acceleration.z,e.accelerationIncludingGravity.x=a.accelerationIncludingGravity.x,e.accelerationIncludingGravity.y=a.accelerationIncludingGravity.y,e.accelerationIncludingGravity.z=a.accelerationIncludingGravity.z,e.rotationRate.alpha=-1*a.rotationRate.gamma,e.rotationRate.beta=-1*a.rotationRate.alpha,e.rotationRate.gamma=a.rotationRate.beta,t.ILaya.Browser.onAndroid?(t.ILaya.Browser.userAgent.indexOf("Chrome")>-1&&(e.rotationRate.alpha*=180/Math.PI,e.rotationRate.beta*=180/Math.PI,e.rotationRate.gamma*=180/Math.PI),e.acceleration.x*=-1,e.accelerationIncludingGravity.x*=-1):t.ILaya.Browser.onIOS&&(e.acceleration.y*=-1,e.acceleration.z*=-1,e.accelerationIncludingGravity.y*=-1,e.accelerationIncludingGravity.z*=-1,i*=1e3),this.event(t.Event.CHANGE,[e.acceleration,e.accelerationIncludingGravity,e.rotationRate,i])}static getTransformedAcceleration(i){var n;return e.transformedAcceleration=e.transformedAcceleration||new a,e.transformedAcceleration.z=i.z,90==t.ILaya.Browser.window.orientation?(e.transformedAcceleration.x=i.y,e.transformedAcceleration.y=-i.x):-90==t.ILaya.Browser.window.orientation?(e.transformedAcceleration.x=-i.y,e.transformedAcceleration.y=i.x):t.ILaya.Browser.window.orientation?180==t.ILaya.Browser.window.orientation&&(e.transformedAcceleration.x=-i.x,e.transformedAcceleration.y=-i.y):(e.transformedAcceleration.x=i.x,e.transformedAcceleration.y=i.y),-90==t.ILaya.stage.canvasDegree?(n=e.transformedAcceleration.x,e.transformedAcceleration.x=-e.transformedAcceleration.y,e.transformedAcceleration.y=n):90==t.ILaya.stage.canvasDegree&&(n=e.transformedAcceleration.x,e.transformedAcceleration.x=e.transformedAcceleration.y,e.transformedAcceleration.y=-n),e.transformedAcceleration}}return e.acceleration=new a,e.accelerationIncludingGravity=new a,e.rotationRate=new i,e})();class o extends t.EventDispatcher{constructor(){super()}static get instance(){return o._instance=o._instance||new o,o._instance}start(e,a){this.throushold=e,this.shakeInterval=a,this.lastX=this.lastY=this.lastZ=NaN,n.instance.on(t.Event.CHANGE,this,this.onShake)}stop(){n.instance.off(t.Event.CHANGE,this,this.onShake)}onShake(e,a,i,n){if(isNaN(this.lastX))return this.lastX=a.x,this.lastY=a.y,this.lastZ=a.z,void(this.lastMillSecond=t.ILaya.Browser.now());var o=Math.abs(this.lastX-a.x),r=Math.abs(this.lastY-a.y),s=Math.abs(this.lastZ-a.z);this.isShaked(o,r,s)&&(t.ILaya.Browser.now()-this.lastMillSecond>this.shakeInterval&&(this.event(t.Event.CHANGE),this.lastMillSecond=t.ILaya.Browser.now()));this.lastX=a.x,this.lastY=a.y,this.lastZ=a.z}isShaked(e,t,a){return e>this.throushold&&t>this.throushold||e>this.throushold&&a>this.throushold||t>this.throushold&&a>this.throushold}}class r{setPosition(e){this.pos=e,this.coords=e.coords}get latitude(){return this.coords.latitude}get longitude(){return this.coords.longitude}get altitude(){return this.coords.altitude}get accuracy(){return this.coords.accuracy}get altitudeAccuracy(){return this.coords.altitudeAccuracy}get heading(){return this.coords.heading}get speed(){return this.coords.speed}get timestamp(){return this.pos.timestamp}}let s=(()=>{class e{constructor(){}static getCurrentPosition(t,a=null){e.navigator.geolocation.getCurrentPosition((function(a){e.position.setPosition(a),t.runWith(e.position)}),(function(e){a.runWith(e)}),{enableHighAccuracy:e.enableHighAccuracy,timeout:e.timeout,maximumAge:e.maximumAge})}static watchPosition(t,a){return e.navigator.geolocation.watchPosition((function(a){e.position.setPosition(a),t.runWith(e.position)}),(function(e){a.runWith(e)}),{enableHighAccuracy:e.enableHighAccuracy,timeout:e.timeout,maximumAge:e.maximumAge})}static clearWatch(t){e.navigator.geolocation.clearWatch(t)}}return e.navigator=t.ILaya.Browser.window.navigator,e.position=new r,e.PERMISSION_DENIED=1,e.POSITION_UNAVAILABLE=2,e.TIMEOUT=3,e.supported=!!e.navigator.geolocation,e.enableHighAccuracy=!1,e.timeout=1e10,e.maximumAge=0,e})(),d=(()=>{class e extends t.Bitmap{constructor(){super(),this._w=0,this._h=0,this._width=1,this._height=1,this.createDomElement()}createDomElement(){this._source=this.video=t.ILaya.Browser.createElement("video");var e=this.video.style;e.position="absolute",e.top="0px",e.left="0px",this.video.addEventListener("loadedmetadata",()=>{this._w=this.video.videoWidth,this._h=this.video.videoHeight})}setSource(e,t){for(;this.video.childElementCount;)this.video.firstChild.remove();1&t&&this.appendSource(e,"video/mp4"),2&t&&this.appendSource(e+".ogg","video/ogg")}appendSource(e,a){var i=t.ILaya.Browser.createElement("source");i.src=e,i.type=a,this.video.appendChild(i)}getVideo(){return this.video}_getSource(){return this._source}destroy(){super.destroy(),t.ILaya.Render.isConchApp&&this.video._destroy()}}return e.create=function(){return new e},e})();class l extends d{constructor(){super();var e=t.LayaGL.instance;!t.ILaya.Render.isConchApp&&t.ILaya.Browser.onIPhone||(this.gl=t.ILaya.Render.isConchApp?window.LayaGLContext.instance:t.WebGLContext.mainContext,this._source=this.gl.createTexture(),t.WebGLContext.bindTexture(this.gl,e.TEXTURE_2D,this._source),this.gl.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),this.gl.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),this.gl.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),this.gl.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),t.WebGLContext.bindTexture(this.gl,e.TEXTURE_2D,null))}updateTexture(){if(t.ILaya.Render.isConchApp||!t.ILaya.Browser.onIPhone){var e=t.LayaGL.instance;t.WebGLContext.bindTexture(this.gl,e.TEXTURE_2D,this._source),this.gl.texImage2D(e.TEXTURE_2D,0,e.RGB,e.RGB,e.UNSIGNED_BYTE,this.video),l.curBindSource=this._source}}get _glTexture(){return this._source}destroy(){this._source&&(this.gl=t.ILaya.Render.isConchApp?window.LayaGLContext.instance:t.WebGLContext.mainContext,l.curBindSource==this._source&&(t.WebGLContext.bindTexture(this.gl,this.gl.TEXTURE_2D,null),l.curBindSource=null),this.gl.deleteTexture(this._source)),super.destroy()}}let h=(()=>{class e extends t.Sprite{constructor(a=320,i=240){super(),this.htmlVideo=new l,this.videoElement=this.htmlVideo.getVideo(),this.videoElement.layaTarget=this,this.internalTexture=new t.Texture(this.htmlVideo),this.videoElement.addEventListener("abort",e.onAbort),this.videoElement.addEventListener("canplay",e.onCanplay),this.videoElement.addEventListener("canplaythrough",e.onCanplaythrough),this.videoElement.addEventListener("durationchange",e.onDurationchange),this.videoElement.addEventListener("emptied",e.onEmptied),this.videoElement.addEventListener("error",e.onError),this.videoElement.addEventListener("loadeddata",e.onLoadeddata),this.videoElement.addEventListener("loadedmetadata",e.onLoadedmetadata),this.videoElement.addEventListener("loadstart",e.onLoadstart),this.videoElement.addEventListener("pause",e.onPause),this.videoElement.addEventListener("play",e.onPlay),this.videoElement.addEventListener("playing",e.onPlaying),this.videoElement.addEventListener("progress",e.onProgress),this.videoElement.addEventListener("ratechange",e.onRatechange),this.videoElement.addEventListener("seeked",e.onSeeked),this.videoElement.addEventListener("seeking",e.onSeeking),this.videoElement.addEventListener("stalled",e.onStalled),this.videoElement.addEventListener("suspend",e.onSuspend),this.videoElement.addEventListener("timeupdate",e.onTimeupdate),this.videoElement.addEventListener("volumechange",e.onVolumechange),this.videoElement.addEventListener("waiting",e.onWaiting),this.videoElement.addEventListener("ended",this.onPlayComplete.bind(this)),this.size(a,i),t.ILaya.Browser.onMobile&&(this.onDocumentClick=this.onDocumentClick.bind(this),t.ILaya.Browser.document.addEventListener("touchend",this.onDocumentClick))}static onAbort(e){e.target.layaTarget.event("abort")}static onCanplay(e){e.target.layaTarget.event("canplay")}static onCanplaythrough(e){e.target.layaTarget.event("canplaythrough")}static onDurationchange(e){e.target.layaTarget.event("durationchange")}static onEmptied(e){e.target.layaTarget.event("emptied")}static onError(e){e.target.layaTarget.event("error")}static onLoadeddata(e){e.target.layaTarget.event("loadeddata")}static onLoadedmetadata(e){e.target.layaTarget.event("loadedmetadata")}static onLoadstart(e){e.target.layaTarget.event("loadstart")}static onPause(e){e.target.layaTarget.event("pause")}static onPlay(e){e.target.layaTarget.event("play")}static onPlaying(e){e.target.layaTarget.event("playing")}static onProgress(e){e.target.layaTarget.event("progress")}static onRatechange(e){e.target.layaTarget.event("ratechange")}static onSeeked(e){e.target.layaTarget.event("seeked")}static onSeeking(e){e.target.layaTarget.event("seeking")}static onStalled(e){e.target.layaTarget.event("stalled")}static onSuspend(e){e.target.layaTarget.event("suspend")}static onTimeupdate(e){e.target.layaTarget.event("timeupdate")}static onVolumechange(e){e.target.layaTarget.event("volumechange")}static onWaiting(e){e.target.layaTarget.event("waiting")}onPlayComplete(e){t.ILaya.Render.isConchApp&&this.videoElement&&this.videoElement.loop||t.ILaya.timer.clear(this,this.renderCanvas),this.event("ended")}load(e){0==e.indexOf("blob:")?this.videoElement.src=e:this.htmlVideo.setSource(e,1)}play(){this.videoElement.play(),t.ILaya.timer.frameLoop(1,this,this.renderCanvas)}pause(){this.videoElement.pause(),t.ILaya.timer.clear(this,this.renderCanvas)}reload(){this.videoElement.load()}canPlayType(e){var t;switch(e){case 1:t="video/mp4";break;case 2:t="video/ogg";break;case 8:t="video/webm"}return this.videoElement.canPlayType(t)}renderCanvas(){0!==this.readyState&&(this.htmlVideo.updateTexture(),this.graphics.clear(),this.graphics.drawTexture(this.internalTexture,0,0,this.width,this.height))}onDocumentClick(){this.videoElement.play(),this.videoElement.pause(),t.ILaya.Browser.document.removeEventListener("touchend",this.onDocumentClick)}get buffered(){return this.videoElement.buffered}get currentSrc(){return this.videoElement.currentSrc}get currentTime(){return this.videoElement.currentTime}set currentTime(e){this.videoElement.currentTime=e,this.renderCanvas()}set volume(e){this.videoElement.volume=e}get volume(){return this.videoElement.volume}get readyState(){return this.videoElement.readyState}get videoWidth(){return this.videoElement.videoWidth}get videoHeight(){return this.videoElement.videoHeight}get duration(){return this.videoElement.duration}get ended(){return this.videoElement.ended}get error(){return this.videoElement.error}get loop(){return this.videoElement.loop}set loop(e){this.videoElement.loop=e}set x(e){if(super.x=e,t.ILaya.Render.isConchApp){var a=t.ILaya.Utils.getTransformRelativeToWindow(this,0,0);this.videoElement.style.left=a.x}}get x(){return super.x}set y(e){if(super.y=e,t.ILaya.Render.isConchApp){var a=t.ILaya.Utils.getTransformRelativeToWindow(this,0,0);this.videoElement.style.top=a.y}}get y(){return super.y}get playbackRate(){return this.videoElement.playbackRate}set playbackRate(e){this.videoElement.playbackRate=e}get muted(){return this.videoElement.muted}set muted(e){this.videoElement.muted=e}get paused(){return this.videoElement.paused}get preload(){return this.videoElement.preload}set preload(e){this.videoElement.preload=e}get seekable(){return this.videoElement.seekable}get seeking(){return this.videoElement.seeking}size(e,a){if(super.size(e,a),t.ILaya.Render.isConchApp){var i=t.ILaya.Utils.getTransformRelativeToWindow(this,0,0);this.videoElement.width=e*i.scaleX}else this.videoElement.width=e/t.ILaya.Browser.pixelRatio;return this.paused&&this.renderCanvas(),this}set width(e){if(t.ILaya.Render.isConchApp){var a=t.ILaya.Utils.getTransformRelativeToWindow(this,0,0);this.videoElement.width=e*a.scaleX}else this.videoElement.width=this.width/t.ILaya.Browser.pixelRatio;super.width=e,this.paused&&this.renderCanvas()}get width(){return super.width}set height(e){if(t.ILaya.Render.isConchApp){var a=t.ILaya.Utils.getTransformRelativeToWindow(this,0,0);this.videoElement.height=e*a.scaleY}else this.videoElement.height=this.height/t.ILaya.Browser.pixelRatio;super.height=e}get height(){return super.height}destroy(t=!0){super.destroy(t),this.videoElement.removeEventListener("abort",e.onAbort),this.videoElement.removeEventListener("canplay",e.onCanplay),this.videoElement.removeEventListener("canplaythrough",e.onCanplaythrough),this.videoElement.removeEventListener("durationchange",e.onDurationchange),this.videoElement.removeEventListener("emptied",e.onEmptied),this.videoElement.removeEventListener("error",e.onError),this.videoElement.removeEventListener("loadeddata",e.onLoadeddata),this.videoElement.removeEventListener("loadedmetadata",e.onLoadedmetadata),this.videoElement.removeEventListener("loadstart",e.onLoadstart),this.videoElement.removeEventListener("pause",e.onPause),this.videoElement.removeEventListener("play",e.onPlay),this.videoElement.removeEventListener("playing",e.onPlaying),this.videoElement.removeEventListener("progress",e.onProgress),this.videoElement.removeEventListener("ratechange",e.onRatechange),this.videoElement.removeEventListener("seeked",e.onSeeked),this.videoElement.removeEventListener("seeking",e.onSeeking),this.videoElement.removeEventListener("stalled",e.onStalled),this.videoElement.removeEventListener("suspend",e.onSuspend),this.videoElement.removeEventListener("timeupdate",e.onTimeupdate),this.videoElement.removeEventListener("volumechange",e.onVolumechange),this.videoElement.removeEventListener("waiting",e.onWaiting),this.videoElement.removeEventListener("ended",this.onPlayComplete),this.pause(),this.videoElement.layaTarget=null,this.videoElement=null,this.htmlVideo.destroy()}syncVideoPosition(){var e,a=t.ILaya.stage;e=t.ILaya.Utils.getGlobalPosAndScale(this);var i=a._canvasTransform.a,n=a._canvasTransform.d,o=e.x*a.clientScaleX*i+a.offset.x,r=e.y*a.clientScaleY*n+a.offset.y;this.videoElement.style.left=o+"px",this.videoElement.style.top=r+"px",this.videoElement.width=this.width/t.ILaya.Browser.pixelRatio,this.videoElement.height=this.height/t.ILaya.Browser.pixelRatio}}return e.MP4=1,e.OGG=2,e.CAMERA=4,e.WEBM=8,e.SUPPORT_PROBABLY="probably",e.SUPPORT_MAYBY="maybe",e.SUPPORT_NO="",e})(),c=(()=>{class e extends t.EventDispatcher{constructor(e){super(),this.onDeviceOrientationChange=this.onDeviceOrientationChange.bind(this)}static get instance(){return e._instance=e._instance||new e(0),e._instance}on(e,a,i,n=null){return super.on(e,a,i,n),t.ILaya.Browser.window.addEventListener("deviceorientation",this.onDeviceOrientationChange),this}off(e,a,i,n=!1){return this.hasListener(e)||t.ILaya.Browser.window.removeEventListener("deviceorientation",this.onDeviceOrientationChange),super.off(e,a,i,n)}onDeviceOrientationChange(a){e.info.alpha=a.alpha,e.info.beta=a.beta,e.info.gamma=a.gamma,a.webkitCompassHeading&&(e.info.alpha=-1*a.webkitCompassHeading,e.info.compassAccuracy=a.webkitCompassAccuracy),this.event(t.Event.CHANGE,[a.absolute,e.info])}}return e.info=new i,e})();e.AccelerationInfo=a,e.Accelerator=n,e.Geolocation=s,e.GeolocationInfo=r,e.Gyroscope=c,e.HtmlVideo=d,e.Media=class{constructor(){}static supported(){return!!t.ILaya.Browser.window.navigator.getUserMedia}static getMedia(e,a,i){t.ILaya.Browser.window.navigator.getUserMedia&&t.ILaya.Browser.window.navigator.getUserMedia(e,(function(e){a.runWith(t.ILaya.Browser.window.URL.createObjectURL(e))}),(function(e){i.runWith(e)}))}},e.RotationInfo=i,e.Shake=o,e.Video=h,e.WebGLVideo=l}(window.Laya=window.Laya||{},Laya);